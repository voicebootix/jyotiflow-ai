services:
  - type: web
    name: jyotiflow-backend
    env: python
    region: oregon
    plan: free
    runtime: python
    # CORE.MD: Removed OpenCV dependencies - using PIL-only image processing for compatibility
    buildCommand: "pip install --upgrade pip && pip install -r backend/requirements.txt --prefer-binary"
    startCommand: "gunicorn -w ${WEB_CONCURRENCY:-1} -k uvicorn.workers.UvicornWorker backend.main:app --bind 0.0.0.0:${PORT}"
    healthCheckPath: "/health"
    envVars:
      - key: PYTHON_VERSION
        value: "3.12.0"
      - key: WEB_CONCURRENCY
        value: "1"

      # Database Configuration (will use your existing DATABASE_URL from dashboard)
      - key: DATABASE_URL
        fromDatabase:
          name: jyotiflow-db
          property: connectionString
      # JWT Secret (should be set in Render dashboard for security)
      - key: JWT_SECRET
        sync: false
      # OpenAI API Key (should be set in Render dashboard for security)
      - key: OPENAI_API_KEY
        sync: false
      # üïâÔ∏è Notification System Environment Variables
      - key: SMTP_HOST
        value: "smtp.gmail.com"  # Replace with your SMTP host
      - key: SMTP_PORT
        value: "587"
      - key: SMTP_USER
        value: "noreply@jyotiflow.ai"  # Replace with your email
      - key: SMTP_PASS
        value: "your-smtp-password"  # Replace with your password
      - key: TWILIO_ACCOUNT_SID
        value: "your-twilio-account-sid"  # Replace with your Twilio SID
      - key: TWILIO_AUTH_TOKEN
        value: "your-twilio-auth-token"  # Replace with your Twilio token
      - key: TWILIO_SMS_NUMBER
        value: "+1234567890"  # Replace with your Twilio SMS number
      - key: TWILIO_WHATSAPP_NUMBER
        value: "whatsapp:+1234567890"  # Replace with your Twilio WhatsApp number
      - key: FIREBASE_SERVICE_ACCOUNT_KEY_PATH
        value: "path/to/firebase-service-account.json"  # Replace with your Firebase key path
      # ü§ñ AI Scheduler Environment Variables
      - key: ENABLE_AI_SCHEDULER
        value: "true"  # Enable daily AI analysis at 2 AM IST
      - key: AI_SCHEDULER_TIMEZONE
        value: "Asia/Kolkata"  # IST timezone for scheduling
      - key: AI_ANALYSIS_INTERVAL_HOURS
        value: "24"  # Run analysis every 24 hours
      # üîÆ Prokerala API Environment Variables (for Smart Pricing)
      - key: PROKERALA_CLIENT_ID
        sync: false  # Set this in Render dashboard for security
      - key: PROKERALA_CLIENT_SECRET
        sync: false  # Set this in Render dashboard for security
      # üåç Global Knowledge Collection Configuration
      - key: ENABLE_GLOBAL_KNOWLEDGE
        value: "true"  # Enable real-time global knowledge collection
      - key: KNOWLEDGE_SEEDING_MODE
        value: "complete"  # traditional + global combined (traditional/global/complete)
      # Environment Configuration
      - key: APP_ENV
        value: "production"

  - type: worker
    name: knowledge-seeder
    env: python
    runtime: python
    buildCommand: "pip install --upgrade pip && pip install -r backend/requirements_minimal.txt --prefer-binary --no-cache-dir"
    startCommand: "python backend/knowledge_seeding_system.py"
    envVars:
      - key: PYTHON_VERSION
        value: "3.12.0"
      - key: DATABASE_URL
        fromDatabase:
          name: jyotiflow-db
          property: connectionString
      - key: OPENAI_API_KEY
        sync: false
      - key: ENABLE_GLOBAL_KNOWLEDGE
        value: "true"
      - key: KNOWLEDGE_SEEDING_MODE
        value: "complete"
    autoDeploy: false # Run this worker manually from the Render dashboard
    
  - type: web
    name: jyotiflow-ai-frontend
    env: static
    buildCommand: cd frontend && npm install --legacy-peer-deps && npm run build
    staticPublishPath: frontend/dist
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: VITE_API_URL
        value: https://jyotiflow-ai.onrender.com
    routes:
      - type: rewrite
        source: /*
        destination: /index.html


