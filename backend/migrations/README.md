# Database Migrations

This directory contains SQL migration files for the JyotiFlow database.

## Migration Files

### 005_fix_user_id_types.sql
- **Purpose**: Fix user_id type mismatches across all tables
- **Created**: Auto-generated by Database Self-Healing System
- **Changes**:
  - Converts all user_id columns from TEXT/VARCHAR to INTEGER
  - Adds foreign key constraints to users table
  - Creates indexes on foreign keys for performance
- **Tables affected**: sessions, credit_transactions, user_purchases, avatar_sessions, live_chat_sessions

## Running Migrations

To run a specific migration:
```bash
psql $DATABASE_URL < backend/migrations/005_fix_user_id_types.sql
```

Or use the self-healing system:
```bash
python backend/database_self_healing_system.py
```

## Migration Best Practices

1. Always wrap migrations in transactions (BEGIN/COMMIT)
2. Test migrations on a backup first
3. Include rollback instructions in comments
4. Name files with sequential numbers for ordering
5. Document what each migration does